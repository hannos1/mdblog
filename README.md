# mdblog后台使用
## 技术栈
- mysql、koa、sequelize
## 数据库表(model)
- 有四张表，分别是users（用户表）、posts（文章表）、blacks（拉黑名单）、likes（点赞文章）
- users表有id、username、password，分别表示主键、用户名和密码
- posts表有id、username、title、summary、contenHash、filePath、updatedAt、deletedAt、userId分别表示主键、作者用户名、文章标题、文章摘要、文章内容的哈希值、文章存放的物理路径、更新或创建文章时间、删除文章时间
- blacks表有id、uid、bid分别表示主键、用户id和该用户拉黑的用户id
- likes表有id、userId、postId分别表示主键、用户id和该用户点赞的文章id
- 其中posts表中的userId依赖users表中的id，blacks表中的uid和bid都依赖users表中的id，likes表中的userId依赖users表的id，postId依赖posts中的id
## 路由(router)
- 用户路由有注册、登录、修改、上传或修改头像
- 文章有首页需要展示的初始化数据、添加文章、查询文章、修改文章、根据标题模糊查询等
- 拉黑和点赞只有两接口，分别是拉黑用户和取消拉黑，点赞文章和取消点赞
## 中间件(middleware)
- 使用了一些自定义的中间件去检查，避免产生错误，比如说检查密码以及用户名不能为空、检查两次密码是否一致，是否有token、id是否有效等
- 以及使用了加密算法（bcryptjs）对密码加密，避免密码的暴露，对文章内容哈希（crypto计算哈希值）处理，如果再次修改哈希内容没有变化就说明没有修改，避免对文件IO操作
- 登录的时候给用户一个token（jsonwebtoken颁发token）
- 中间件是在controller（控制层）之前使用
## 控制层(controller)
- 将数据给服务层，返回给浏览器响应数据，每个操作对应控制层的一个方法，该方法调用服务层的方法
## 服务处(service)
- 实际操作数据库的层次，不同操作创建不同方法与之对应，将操作结果返回给控制层
## 错误常量(constant)
- 定义一些错误的状态码和错误信息，以便复用
## 配置(config)
- 使用了dotenv从.env文件读取变量，并注入到nodejs中的process.env对象，避免数据库隐私数据暴露且方便修改（不是写死，使用变量代替，方便修改）
## 静态资源目录(public)
- 将用户上传的头像放在该目录下，服务器可以根据地址直接访问并使用
## 优化处
- 读取路由的时候，使用了fs模块将该目录下路由读取出来，避免有多少路由手动注册多少路由
- 将入口(main.js)与一些预处理(app.js)分离开，方便维护